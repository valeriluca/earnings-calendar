<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      <p-heading [size]="'large'" [theme]="'dark'">Earnings List</p-heading>
    </ion-title>
    <ion-buttons slot="end">
      <p-button-pure [icon]="'reset'" (click)="loadEarnings()" [hideLabel]="true" [theme]="'dark'">
        Refresh
      </p-button-pure>
      <p-button-pure [icon]="'configurate'" (click)="navigateToSettings()" [hideLabel]="true" [theme]="'dark'">
        Settings
      </p-button-pure>
    </ion-buttons>
  </ion-toolbar>
  <ion-toolbar>
    <p-segmented-control [value]="selectedFilter" (update)="onFilterChange($event)" [theme]="'dark'">
      <p-segmented-control-item [value]="'all'">All</p-segmented-control-item>
      <p-segmented-control-item [value]="'today'">Today</p-segmented-control-item>
      <p-segmented-control-item [value]="'week'">This Week</p-segmented-control-item>
    </p-segmented-control>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="p-6">
    <!-- Loading State -->
    <div *ngIf="loading" class="flex flex-col items-center justify-center min-h-[400px] gap-4">
      <p-spinner [size]="'large'" [theme]="'dark'"></p-spinner>
      <p-text [size]="'medium'" [theme]="'dark'" class="text-[#C9C9CB]">Loading earnings...</p-text>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="flex flex-col items-center justify-center min-h-[400px] gap-4">
      <p-text [size]="'large'" [theme]="'dark'" class="text-[#8B1538]">{{ error }}</p-text>
      <p-button (click)="loadEarnings()" [variant]="'secondary'" [theme]="'dark'">
        Retry
      </p-button>
    </div>

    <!-- Earnings List -->
    <div *ngIf="!loading && !error && filteredEarnings.length > 0" class="space-y-3">
      <div *ngFor="let event of filteredEarnings" 
           class="bg-[#2C2C2E] rounded-lg p-6 shadow-lg hover:bg-[#3A3A3C] transition-colors"
           [class.border-l-4]="isToday(event.date)"
           [class.border-[#8B1538]]="isToday(event.date)">
        <div class="flex justify-between items-start">
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-2">
              <p-heading [size]="'medium'" [theme]="'dark'">{{ event.name || event.symbol }}</p-heading>
              <p-tag *ngIf="isToday(event.date)" [color]="'notification-error'" [theme]="'dark'">TODAY</p-tag>
            </div>
            <p-text [size]="'small'" [theme]="'dark'" class="block mb-1 text-[#C9C9CB]" style="padding: 4px 0;">
              {{ formatDisplayDate(event.date) }}
            </p-text>
            <p-text [size]="'small'" [theme]="'dark'" class="block mb-1" [style.color]="getTimeInfo(event).color" style="padding: 4px 0;">
              {{ getTimeInfo(event).label }}
            </p-text>
            <p-text *ngIf="event.epsEstimated" [size]="'x-small'" [theme]="'dark'" class="block text-[#C9C9CB]" style="padding: 4px 0;">
              EPS Est: {{ event.epsEstimated }}
            </p-text>
          </div>
          <p-tag [color]="getTagColor(event.time)" [theme]="'dark'">
            {{ event.time || '?' }}
          </p-tag>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !error && filteredEarnings.length === 0" class="flex flex-col items-center justify-center min-h-[400px] gap-4">
      <p-text [size]="'large'" [theme]="'dark'" class="text-[#C9C9CB]">
        No earnings found for the selected period.
      </p-text>
      <p-button (click)="navigateToSettings()" [variant]="'secondary'" [theme]="'dark'">
        Manage Watchlist
      </p-button>
    </div>
  </div>
</ion-content>
